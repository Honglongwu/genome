#!/usr/bin/env genome-perl

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
};

use strict;
use warnings;

use above 'Genome';
use Test::More;

my $lims_class = 'Genome::Site::TGI::Synchronize::Classes::LimsProject';
use_ok($lims_class) or die;

my $entity_name = $lims_class->entity_name;
is($entity_name, 'project', 'entity name');
my $expected_genome_class = 'Genome::'.ucfirst($entity_name);
is($lims_class->genome_class_for_comparison, $expected_genome_class, 'genome class for create');
is($lims_class->genome_class_for_create, $expected_genome_class, 'genome class for create');

my %properties = (
    id => -11,
    name => '__TEST_PROJECT__',
);
my $lims_object = $lims_class->__define__(%properties);
ok($lims_object, "define lims $entity_name object");
can_ok($lims_object, 'pipeline');

my $genome_object = $lims_object->create_in_genome;
ok($genome_object, "create genome $entity_name object");
isa_ok($genome_object, $expected_genome_class);

for my $property ( keys %properties ) {
    my $value = eval{ $genome_object->$property; };
    $value = eval{ $genome_object->attributes(attribute_label => $property)->attribute_value; } if not defined $value;
    is($value, $properties{$property}, "genome and lims $property matches => $value");
}

done_testing();
