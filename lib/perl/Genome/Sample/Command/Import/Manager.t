#!/usr/bin/env genome-perl

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
    $ENV{UR_COMMAND_DUMP_STATUS_MESSAGES} = 1;
}

use strict;
use warnings;

use above "Genome";
use Test::More;

use_ok('Genome::Sample::Command::Import::Manager') or die;

my $manager = Genome::Sample::Command::Import::Manager->create(
    working_directory => 'example/valid',
);
ok($manager, 'create manager');
my $samples_from_csv_file = $manager->_load_samples_from_csv_file;
my $expected_samples_from_csv_file = { 
    'TEST-0000-00' => { 
        name => 'TEST-0000-00', 
        from_csv => { race => 'spaghetti', gender => 'female', religion => 'pastafarian', },
    },
};
is_deeply($samples_from_csv_file, $expected_samples_from_csv_file, 'samples from csv file');

# fail - no name column in csv
$manager->working_directory('example/invalid');
$samples_from_csv_file = $manager->_load_samples_from_csv_file;
ok(!$samples_from_csv_file, 'failed to load samples b/c no name column in sample csv');
is($manager->error_message, 'No name column in sample csv! '.$manager->sample_csv_file, 'correct error');

done_testing();
