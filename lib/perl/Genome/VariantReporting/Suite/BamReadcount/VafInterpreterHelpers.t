#!/usr/bin/env genome-perl

BEGIN { 
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
}

use strict;
use warnings;

use above "Genome";
use Test::More;
use List::Util qw(shuffle);

my $pkg = 'Genome::VariantReporting::Suite::BamReadcount::VafInterpreterHelpers';
use_ok($pkg);

subtest 'custom_vaf_sort - one sample' => sub {
    my @headers = qw(sample_ref_count sample_var_count sample_vaf);
    my @sorted_headers = Genome::VariantReporting::Suite::BamReadcount::VafInterpreterHelpers::sort_vaf_headers(
        headers => [shuffle(@headers)],
        sample_names => ['sample'],
    );
    is_deeply(
        [@sorted_headers],
        [@headers],
        'Sample vaf headers sorted as expected'
    );
};

subtest 'custom_vaf_sort - multiple samples' => sub {
    my @headers = qw(
        sample1_ref_count sample1_var_count sample1_vaf
        sample2_ref_count sample2_var_count sample2_vaf
    );
    my @sorted_headers = Genome::VariantReporting::Suite::BamReadcount::VafInterpreterHelpers::sort_vaf_headers(
        headers => [shuffle(@headers)],
        sample_names => ['sample1', 'sample2'],
    );
    is_deeply(
        [@sorted_headers],
        [@headers],
        'Sample vaf headers sorted as expected'
    );

};

subtest 'custom_vaf_sort - per library' => sub {
    my @headers = qw(
        sample-library1_ref_count sample-library1_var_count sample-library1_vaf
        sample-library2_ref_count sample-library2_var_count sample-library2_vaf
    );
    my @sorted_headers = Genome::VariantReporting::Suite::BamReadcount::VafInterpreterHelpers::sort_vaf_headers(
        headers => [shuffle(@headers)],
        sample_names => ['sample'],
        library_names => ['library1', 'library2'],
    );
    is_deeply(
        [@sorted_headers],
        [@headers],
        'Sample vaf headers sorted as expected'
    );
};

subtest 'custom_vaf_sort - cle per sample' => sub {
    my @headers = qw(
        Normal(H_KA-174556-1309237)_ref_count
        Normal(H_KA-174556-1309237)_var_count
        Normal(H_KA-174556-1309237)_vaf
        Discovery(H_KA-174556-1309245)_ref_count
        Discovery(H_KA-174556-1309245)_var_count
        Discovery(H_KA-174556-1309245)_vaf
        Followup(H_KA-174556-1309246)_ref_count
        Followup(H_KA-174556-1309246)_var_count
        Followup(H_KA-174556-1309246)_vaf
    );
    my @sorted_headers = Genome::VariantReporting::Suite::BamReadcount::VafInterpreterHelpers::sort_vaf_headers(
        headers => [shuffle(@headers)],
        sample_names => ['H_KA-174556-1309237', 'H_KA-174556-1309245', 'H_KA-174556-1309246'],
        library_names => ['Library1', 'Library2', 'Library3'],
    );
    is_deeply(
        [@sorted_headers],
        [@headers],
        'Sample vaf headers sorted as expected'
    );
};

subtest 'custom_vaf_sort - cle per library' => sub {
    my @headers = qw(
        Normal-Library1(H_KA-174556-1309237-lg3-lib1)_ref_count
        Normal-Library1(H_KA-174556-1309237-lg3-lib1)_var_count
        Normal-Library1(H_KA-174556-1309237-lg3-lib1)_vaf
        Normal-Library2(H_KA-174556-1309237-lg4-lib1)_ref_count
        Normal-Library2(H_KA-174556-1309237-lg4-lib1)_var_count
        Normal-Library2(H_KA-174556-1309237-lg4-lib1)_vaf
        Normal-Library3(H_KA-174556-1309237-lg5-lib1)_ref_count
        Normal-Library3(H_KA-174556-1309237-lg5-lib1)_var_count
        Normal-Library3(H_KA-174556-1309237-lg5-lib1)_vaf
        Discovery-Library1(H_KA-174556-1309245-lg3-lib1)_ref_count
        Discovery-Library1(H_KA-174556-1309245-lg3-lib1)_var_count
        Discovery-Library1(H_KA-174556-1309245-lg3-lib1)_vaf
        Discovery-Library2(H_KA-174556-1309245-lg5-lib1)_ref_count
        Discovery-Library2(H_KA-174556-1309245-lg5-lib1)_var_count
        Discovery-Library2(H_KA-174556-1309245-lg5-lib1)_vaf
        Discovery-Library3(H_KA-174556-1309245-lg6-lib1)_ref_count
        Discovery-Library3(H_KA-174556-1309245-lg6-lib1)_var_count
        Discovery-Library3(H_KA-174556-1309245-lg6-lib1)_vaf
        Followup-Library1(H_KA-174556-1309246-lg2-lib1)_ref_count
        Followup-Library1(H_KA-174556-1309246-lg2-lib1)_var_count
        Followup-Library1(H_KA-174556-1309246-lg2-lib1)_vaf
        Followup-Library2(H_KA-174556-1309246-lg4-lib1)_ref_count
        Followup-Library2(H_KA-174556-1309246-lg4-lib1)_var_count
        Followup-Library2(H_KA-174556-1309246-lg4-lib1)_vaf
        Followup-Library3(H_KA-174556-1309246-lg5-lib1)_ref_count
        Followup-Library3(H_KA-174556-1309246-lg5-lib1)_var_count
        Followup-Library3(H_KA-174556-1309246-lg5-lib1)_vaf
    );
    my @sorted_headers = Genome::VariantReporting::Suite::BamReadcount::VafInterpreterHelpers::sort_vaf_headers(
        headers => [shuffle(@headers)],
        sample_names => ['H_KA-174556-1309237', 'H_KA-174556-1309245', 'H_KA-174556-1309246'],
        library_names => ['Library1', 'Library2', 'Library3'],
    );
    is_deeply(
        [@sorted_headers],
        [@headers],
        'Sample vaf headers sorted as expected'
    );
};

done_testing;
