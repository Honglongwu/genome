#!/usr/bin/env perl

use above 'Genome';
use Test::More;
use IO::String;
use File::Slurp qw(read_file);

use strict;
use warnings;

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
}

my $pkg = "Genome::File::Breakdancer::Reader";

use_ok($pkg);

my @input_lines = <DATA>;
my $input_string = join("", @input_lines);
chomp @input_lines;

subtest "next" => sub {
    my $fh = new IO::String($input_string);
    my $reader = $pkg->fhopen($fh, "Test File");

    # Peek!
    my $entry = $reader->peek;
    ok($entry , 'Peeked at first entry');

    is($entry->to_string, $input_lines[0], 'got expected (peek)');
    $entry = $reader->next;
    is($entry->to_string, $input_lines[0], 'got expected (next)');

    $entry = $reader->peek;
    is($entry->to_string, $input_lines[1], 'got expected (peek)');
    $entry = $reader->next;
    is($entry->to_string, $input_lines[1], 'got expected (next)');

    $entry = $reader->peek;
    is($entry->to_string, $input_lines[2], 'got expected (peek)');
    $entry = $reader->next;
    is($entry->to_string, $input_lines[2], 'got expected (next)');

    $entry = $reader->peek;
    ok(!$entry, 'Cannot peek into the void');
    $entry = $reader->next;
    ok(!$entry, 'Cannot read from the void');
};

done_testing();

__DATA__
1	10	2+0-	1	20	0+2-	DEL	10	35	2	lib1|2,2.89
1	11	16+5-	1	21	16+5-	INS	-10	32	3	lib1|1,0.01:lib2|2,NA
1	12	3+8-	1	22	3+8-	ITX	-10	43	3	lib1|1,NA:lib2|2,NA
