#!/usr/bin/env perl

use Data::Dumper;
use File::Temp qw/tempdir/;
use Test::More;
use above 'Genome';

use strict;
use warnings;

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
}

my $pkg = 'Genome::Model::PhenotypeCorrelation::ClinicalData';
use_ok($pkg);

my $tmpdir = tempdir(
    't-ClinicalData-badhdr-XXXXX',
    DIR => '/gsc/var/cache/testsuite/running_testsuites',
    CLEANUP => 1
);

my $output_file = "$tmpdir/clin.tsv";
my $ofh = new IO::File($output_file, "w");
$ofh->write("Sample_Name\tPhenotype\n");
$ofh->write("S1\t0\t1\n"); # extra column
$ofh->close();

eval {
    $pkg->from_file(new IO::File($output_file, "r"));
};
ok($@, "Extra data column throws an error");

$ofh = new IO::File($output_file, "w");
$ofh->write("Sample_Name\tPhenotype1\tPhenotype2\n");
$ofh->write("S1\t0\n"); # missing column
$ofh->close();

eval {
    $pkg->from_file(new IO::File($output_file, "r"));
};
ok($@, "Missing data column throws an error");



done_testing();
