#!/gsc/bin/perl

BEGIN { 
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
}

use strict;
use warnings;

use above "Genome";
use Test::More;

my $class = 'Genome::Model::Tools::RegulomeDb::ModifyRoisBasedOnScore';
use_ok($class);

my $roi = "11\t5248049\t5248053\n14\t100705101\t100705104";
my $expected_expanded = "11\t5248049\t5248050\n11\t5248050\t5248051\n11\t5248051\t5248052\n11\t5248052\t5248053\n14\t100705101\t100705102\n14\t100705102\t100705103\n14\t100705103\t100705104";
my $expanded = $class->expand_rois($roi);
is($expanded, $expected_expanded, "ROI expanded correctly");

my $roi1 = "11\t5248049\t5248050";
my $roi2 = "11\t5248052\t5248053";
my $expected_combined = "11\t5248049\t5248053";
my $combined = $class->combine_rois($roi1, $roi2);
is($combined, $expected_combined, "ROIs combined correctly");

my $cmd = $class->create(valid_scores => ["1", "2"], roi_list => "fake", output_file => "fake.out");
my $score_line1 = "chr11\t5248049\t5248050\trs1;1f";
my $score_line2 = "chr11\t5248050\t5248051\trs1;2c";
my $score_line3 = "chr11\t5248051\t5248052\trs1;3a";
my $score_line4 = "chr11\t5248052\t5248053\trs1;2c";

ok($cmd->good_score($score_line1), "1f is a good score");
ok($cmd->good_score($score_line2), "2c is a good score");
ok(!$cmd->good_score($score_line3), "3a is not a good score");

my $input_roi = "11\t5248049\t5248053\tgeneA";
my $expected_processed_roi = "11\t5248049\t5248051\tgeneA\n11\t5248052\t5248053\tgeneA";
my $modified_roi = $cmd->process_roi(
    $input_roi,
    $score_line1,
    $score_line2,
    $score_line3,
    $score_line4
);
is($modified_roi, $expected_processed_roi, "ROI was processed correctly");

done_testing;

