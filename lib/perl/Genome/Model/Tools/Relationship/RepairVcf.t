#!/usr/bin/env genome-perl

use strict;
use warnings;

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
};

use above "Genome";
use Genome::Utility::Vcf 'diff_vcf_file_vs_file';
use Genome::Model::Tools::Relationship::RepairVcf "fix_alt_and_GT_field";

use Test::More;


my @inputs = ("A", "A,C", "GT:OT", "1/0:foo", "1/2:bar");
my @expected_results = ("C", "GT:OT", "0/0:foo", "0/1:bar");
my @results = fix_alt_and_GT_field(@inputs);
is_deeply(\@results, \@expected_results, 'fixes ref in begining of alt');


@inputs = ("A", "C,A,T", "OT:GT", "foo:1/2", "bar:1/3");
@expected_results = ("C,T", "GT:OT", "1/0:foo", "1/2:bar");
@results = fix_alt_and_GT_field(@inputs);
is_deeply(\@results, \@expected_results, 'fixes ref in middle of alt and reorders format');


@inputs = ("A", "A,A", "GT", "1/2", "1|2");
@expected_results = (".", "GT", "0/0", "0|0");
@results = fix_alt_and_GT_field(@inputs);
is_deeply(\@results, \@expected_results, 'fixes no real alts and | as well as /');


@inputs = ("A", "C,T", "BT:QR", "1/2:foo", "1|2:bar");
@expected_results = ("C,T", "BT:QR", "1/2:foo", "1|2:bar");
@results = fix_alt_and_GT_field(@inputs);
is_deeply(\@results, \@expected_results, 'leaves correct lines alone.');


done_testing();

1;
