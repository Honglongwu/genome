#!/usr/bin/env genome-perl

BEGIN {
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_COMMAND_DUMP_STATUS_MESSAGES} = 1;
}

use strict;
use warnings;

use above 'Genome';

use Test::More;

use_ok('Genome::Model::Tools::Lims::ApipeBridge::UpdateGenomeAndGscTaxons') or die;

my $name = '__TEST_TAXON__';
my $taxon = Genome::Taxon->__define__(name => $name, estimated_genome_size => 10);
my $gsc_taxon = Genome::Site::TGI::Taxon->__define__(id => $taxon->id, species_name => $name, domain => 'Eukaryota');

my $fixer = Genome::Model::Tools::Lims::ApipeBridge::UpdateGenomeAndGscTaxons->create(
    taxons => [$taxon],
    estimated_genome_size => 10_000_000,
    domain => 'Bacteria',
);
ok($fixer, 'create');
ok($fixer->execute, 'execute');
is($taxon->domain, 'Bacteria', 'updated genome domain');
is($gsc_taxon->domain, 'Bacteria', 'updated lims domain');
is($taxon->estimated_genome_size, 10_000_000, 'update genome est genome size');
is($gsc_taxon->estimated_genome_size, 10_000_000, 'updated lims est genome size');

done_testing();
