#!/usr/bin/env genome-perl

use strict;
use warnings FATAL => 'all';

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
};

use above "Genome";
use Test::More;
use Genome::Utility::Test qw(compare_ok);

my $pkg = 'Genome::Model::Tools::Sam::Readcount';
use_ok($pkg) or die;
my $test_data_dir = Genome::Utility::Test->data_dir_ok($pkg, '1');

my $output = Genome::Sys->create_temp_file_path;
my $expected = File::Spec->join($test_data_dir, 'expected');

my $reference = Genome::Model::Build::ImportedReferenceSequence->get_by_name('NCBI-human-build36');

my $cmd = $pkg->create(
    output_file => $output,
    bam_file => File::Spec->join($test_data_dir, 'tiny.bam'),
    region_list => File::Spec->join($test_data_dir, 'regions'),
    reference_fasta => $reference->full_consensus_path('fa'),
);

ok($cmd->execute, "Executed $pkg");

compare_ok($expected, $output, 'readcount file looks as expected');
done_testing();

