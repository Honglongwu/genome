#!/usr/bin/env genome-perl

use strict;
use warnings;

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
};

use above 'Genome';
use Genome::SoftwareResult;
use Test::More;
use File::Compare;

my $class = 'Genome::Model::Tools::DetectVariants2::VarscanBase';
use_ok($class);

my $expected_samtools_version = "r982";
my $expected_samtools_param_string = "--nobaq --version $expected_samtools_version";
my $expected_varscan_params = "--min-coverage 3 --min-var-freq 0.20 --p-value 0.10 --strand-filter 1 --map-quality 10";
my $params = "$expected_samtools_param_string:$expected_varscan_params";
my $good_version = "2.3.6";
my $bad_version = "bad_version";

my ($samtools_params, $varscan_params) = $class->_split_params($params);

is($samtools_params, $expected_samtools_param_string, "samtools params are correct");
is($varscan_params, $expected_varscan_params, "varscan params are correct");

my ($samtools_version, $use_baq, $params) = $class->_process_samtools_params($samtools_params);
is($samtools_version, $expected_samtools_version, "samtools version is correct");

is($use_baq, "0", "use_baq value is correct");

ok($class->has_version($good_version), "Correct version returns true");
ok(!$class->has_version($bad_version), "Incorrect version returns false");

done_testing();
