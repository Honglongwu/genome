<?xml version='1.0' standalone='yes'?>

<workflow name="Epitope Binding Prediction Pipeline" logDir="/gsc/var/log/genome/epitope_binding_prediction_pipeline">
  <link fromOperation="input connector" fromProperty="input_tsv_file" toOperation="Get Wildtype" toProperty="input_tsv_file" />
  <link fromOperation="input connector" fromProperty="output_directory" toOperation="Get Wildtype" toProperty="output_directory" />
  <link fromOperation="input connector" fromProperty="anno_db" toOperation="Get Wildtype" toProperty="anno_db" />
  <link fromOperation="input connector" fromProperty="anno_db_version" toOperation="Get Wildtype" toProperty="anno_db_version" />

  <link fromOperation="Get Wildtype" fromProperty="output_tsv_file" toOperation="Generate Variant Sequences" toProperty="input_file" />
  <link fromOperation="input connector" fromProperty="output_directory" toOperation="Generate Variant Sequences" toProperty="output_directory" />
  <link fromOperation="input connector" fromProperty="peptide_sequence_length" toOperation="Generate Variant Sequences" toProperty="peptide_sequence_length" />

  <link fromOperation="input connector" fromProperty="output_directory" toOperation="Remove Star Sequences" toProperty="output_directory" />
  <link fromOperation="Generate Variant Sequences" fromProperty="output_file" toOperation="Remove Star Sequences" toProperty="input_file" />

  <link fromOperation="input connector" fromProperty="output_directory" toOperation="Generate Fasta Key" toProperty="output_directory" />
  <link fromOperation="Remove Star Sequences" fromProperty="output_file" toOperation="Generate Fasta Key" toProperty="input_file" />

  <link fromOperation="input connector" fromProperty="output_directory" toOperation="Run NetMHC" toProperty="output_directory" />
  <link fromOperation="input connector" fromProperty="allele" toOperation="Run NetMHC" toProperty="allele" />
  <link fromOperation="input connector" fromProperty="epitope_length" toOperation="Run NetMHC" toProperty="epitope_length" />
  <link fromOperation="input connector" fromProperty="netmhc_version" toOperation="Run NetMHC" toProperty="version" />
  <link fromOperation="input connector" fromProperty="sample_name" toOperation="Run NetMHC" toProperty="sample_name" />
  <link fromOperation="Remove Star Sequences" fromProperty="output_file" toOperation="Run NetMHC" toProperty="fasta_file" />

  <link fromOperation="input connector" fromProperty="output_directory" toOperation="Parse NetMHC Output" toProperty="output_directory" />
  <link fromOperation="input connector" fromProperty="output_filter" toOperation="Parse NetMHC Output" toProperty="output_type" />
  <link fromOperation="input connector" fromProperty="netmhc_version" toOperation="Parse NetMHC Output" toProperty="netmhc_version" />
  <link fromOperation="Run NetMHC" fromProperty="output_file" toOperation="Parse NetMHC Output" toProperty="netmhc_file" />
  <link fromOperation="Generate Fasta Key" fromProperty="output_file" toOperation="Parse NetMHC Output" toProperty="key_file" />

  <link fromOperation="Parse NetMHC Output" fromProperty="parsed_file" toOperation="output connector" toProperty="output_file" />

  <operation name="Get Wildtype">
    <operationtype commandClass="Genome::Model::Tools::EpitopePrediction::GetWildtype" typeClass="Workflow::OperationType::Command" />
  </operation>
  <operation name="Generate Variant Sequences">
    <operationtype commandClass="Genome::Model::Tools::EpitopePrediction::GenerateVariantSequences" typeClass="Workflow::OperationType::Command" />
  </operation>
  <operation name="Remove Star Sequences">
    <operationtype commandClass="Genome::Model::Tools::EpitopePrediction::RemoveStarSequences" typeClass="Workflow::OperationType::Command" />
  </operation>
  <operation name="Generate Fasta Key">
    <operationtype commandClass="Genome::Model::Tools::EpitopePrediction::GenerateFastaKey" typeClass="Workflow::OperationType::Command" />
  </operation>
  <operation name="Run NetMHC">
    <operationtype commandClass="Genome::Model::Tools::EpitopePrediction::RunNetmhc" typeClass="Workflow::OperationType::Command" />
  </operation>
  <operation name="Parse NetMHC Output">
    <operationtype commandClass="Genome::Model::Tools::EpitopePrediction::ParseNetmhcOutput" typeClass="Workflow::OperationType::Command" />
  </operation>

  <operationtype typeClass="Workflow::OperationType::Model">
    <inputproperty>input_tsv_file</inputproperty>
    <inputproperty>output_directory</inputproperty>
    <inputproperty>anno_db</inputproperty>
    <inputproperty>anno_db_version</inputproperty>
    <inputproperty>peptide_sequence_length</inputproperty>
    <inputproperty>allele</inputproperty>
    <inputproperty>epitope_length</inputproperty>
    <inputproperty>netmhc_version</inputproperty>
    <inputproperty>output_filter</inputproperty>
    <inputproperty>sample_name</inputproperty>
    <outputproperty>output_file</outputproperty>
  </operationtype>

</workflow>
