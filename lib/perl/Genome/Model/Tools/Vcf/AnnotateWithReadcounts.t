#!/usr/bin/env genome-perl

BEGIN { 
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
}

use strict;
use warnings;

use above "Genome";
use Test::More;
use Genome::Utility::Test qw(compare_ok);

my $pkg = 'Genome::Model::Tools::Vcf::AnnotateWithReadcounts';

use_ok($pkg);
my $data_dir = Genome::Utility::Test->data_dir_ok($pkg, "v1");

my $out = Genome::Sys->create_temp_file_path;
my $cmd = Genome::Annotation::AddReadcount->create(
    vcf_file => File::Spec->join($data_dir, "1.vcf.gz"),
    readcount_files => [
        File::Spec->join($data_dir, 'test1.rc.tsv'),
        File::Spec->join($data_dir, 'test2.rc.tsv'),
    ],
    sample_names => [
        'TEST-patient1-somval_tumor1',
        'TEST-patient1-somval_normal1',
    ],
    output_file => $out,
);
ok($cmd->isa("Genome::Annotation::AddReadcount"), "Command created ok");
ok($cmd->execute, "Command executed ok");

my $expected_out = File::Spec->join($data_dir, "expected.vcf");
compare_ok($expected_out, $out, "Vcf was written correctly");

done_testing;

