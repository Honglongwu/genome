<?xml version='1.0' standalone='yes'?>
<workflow name="BackfillIndelVcf">
    <link fromOperation="input connector" fromProperty="input_bam" toOperation="GetSampleName" toProperty="bam_file" />

    <link fromOperation="GetSampleName" fromProperty="sample_name" toOperation="CreateOutputDirectory" toProperty="sample_name" />
    <link fromOperation="input connector" fromProperty="base_directory" toOperation="CreateOutputDirectory" toProperty="base_directory" />

    <link fromOperation="CreateOutputDirectory" fromProperty="output_directory" toOperation="RealignWithDindel" toProperty="output_directory" />
    <link fromOperation="input connector" fromProperty="input_bam" toOperation="RealignWithDindel" toProperty="input_bam" />
    <link fromOperation="input connector" fromProperty="ref_fasta" toOperation="RealignWithDindel" toProperty="ref_fasta" />
    <link fromOperation="input connector" fromProperty="input_vcf" toOperation="RealignWithDindel" toProperty="input_vcf" />

    <link fromOperation="CreateOutputDirectory" fromProperty="output_directory" toOperation="DetermineVarscanOptions" toProperty="output_directory" />

    <link fromOperation="RealignWithDindel" fromProperty="output_bam" toOperation="VarscanConsensus" toProperty="bam_file" />
    <link fromOperation="DetermineVarscanOptions" fromProperty="output_file" toOperation="VarscanConsensus" toProperty="output_file" />
    <link fromOperation="DetermineVarscanOptions" fromProperty="output_vcf" toOperation="VarscanConsensus" toProperty="output_vcf" />
    <link fromOperation="GetSampleName" fromProperty="sample_name" toOperation="VarscanConsensus" toProperty="vcf_sample_name" />
    <link fromOperation="input connector" fromProperty="ref_fasta" toOperation="VarscanConsensus" toProperty="ref_fasta" />

    <link fromOperation="VarscanConsensus" fromProperty="output_file" toOperation="output connector" toProperty="output_vcf" />

    <operation name="GetSampleName">
        <operationtype commandClass="Genome::Model::Tools::Sam::GetSampleName" typeClass="Workflow::OperationType::Command" />
    </operation>
    <operation name="CreateOutputDirectory">
        <operationtype commandClass="Genome::Model::Tools::Vcf::CreateCrossSampleVcf::CreateOutputDirectory" typeClass="Workflow::OperationType::Command" />
    </operation>
    <operation name="RealignWithDindel" workflowFile="../../Dindel/RealignWithVcf.xml" />
    <operation name="DetermineVarscanOptions">
        <operationtype commandClass="Genome::Model::Tools::Vcf::CreateCrossSampleVcf::DetermineVarscanOptions" typeClass="Workflow::OperationType::Command" />
    </operation>
    <operation name="VarscanConsensus">
        <operationtype commandClass="Genome::Model::Tools::Varscan::Consensus" typeClass="Workflow::OperationType::Command" />
    </operation>

    <operationtype typeClass="Workflow::OperationType::Model">
        <inputproperty>input_bam</inputproperty>
        <inputproperty>ref_fasta</inputproperty>
        <inputproperty>input_vcf</inputproperty>
        <inputproperty>base_directory</inputproperty>

        <outputproperty>output_vcf</outputproperty>
    </operationtype>
</workflow>
