<?xml version='1.0' standalone='yes'?>
<workflow name="BackfillIndelVcf">
    <link fromOperation="input connector" fromProperty="input_bam" toOperation="GetSampleName" toProperty="bam_file" />

    <link fromOperation="GetSampleName" fromProperty="sample_name" toOperation="CreateOutputDirectory" toProperty="sample_name" />
    <link fromOperation="input connector" fromProperty="base_directory" toOperation="CreateOutputDirectory" toProperty="base_directory" />

    <link fromOperation="CreateOutputDirectory" fromProperty="output_directory" toOperation="RealignWithDindel" toProperty="output_directory" />
    <link fromOperation="input connector" fromProperty="input_bam" toOperation="RealignWithDindel" toProperty="input_bam" />
    <link fromOperation="input connector" fromProperty="ref_fasta" toOperation="RealignWithDindel" toProperty="ref_fasta" />
    <link fromOperation="input connector" fromProperty="input_vcf" toOperation="RealignWithDindel" toProperty="input_vcf" />

    <link fromOperation="CreateOutputDirectory" fromProperty="output_directory" toOperation="DetermineVarscanOptions" toProperty="output_directory" />

    <link fromOperation="RealignWithDindel" fromProperty="output_bam" toOperation="VarscanConsensus" toProperty="bam_file" />
    <link fromOperation="DetermineVarscanOptions" fromProperty="output_file" toOperation="VarscanConsensus" toProperty="output_file" />
    <link fromOperation="DetermineVarscanOptions" fromProperty="output_vcf" toOperation="VarscanConsensus" toProperty="output_vcf" />
    <link fromOperation="GetSampleName" fromProperty="sample_name" toOperation="VarscanConsensus" toProperty="vcf_sample_name" />
    <link fromOperation="input connector" fromProperty="ref_fasta" toOperation="VarscanConsensus" toProperty="ref_fasta" />

    <link fromOperation="VarscanConsensus" fromProperty="output_file" toOperation="output connector" toProperty="output_vcf" />

    <operation name="GetSampleName">
        <operationtype commandClass="Genome::Model::Tools::Sam::GetSampleName" typeClass="Workflow::OperationType::Command" />
    </operation>
    <operation name="CreateOutputDirectory">
        <operationtype commandClass="Genome::Model::Tools::Vcf::CreateCrossSampleVcf::CreateOutputDirectory" typeClass="Workflow::OperationType::Command" />
    </operation>
    <operation name="DetermineVarscanOptions">
        <operationtype commandClass="Genome::Model::Tools::Vcf::CreateCrossSampleVcf::DetermineVarscanOptions" typeClass="Workflow::OperationType::Command" />
    </operation>
    <operation name="VarscanConsensus">
        <operationtype commandClass="Genome::Model::Tools::Varscan::Consensus" typeClass="Workflow::OperationType::Command" />
    </operation>

    <operation name="RealignWithDindel">
        <link fromOperation="input connector" fromProperty="input_vcf" toOperation="VcfToDindel" toProperty="input_vcf" />
        <link fromOperation="input connector" fromProperty="ref_fasta" toOperation="VcfToDindel" toProperty="ref_fasta" />
        <link fromOperation="input connector" fromProperty="output_directory" toOperation="VcfToDindel" toProperty="output_directory" />

        <link fromOperation="VcfToDindel" fromProperty="output_dindel_file" toOperation="RealignCandidates" toProperty="input_dindel_file" />
        <link fromOperation="input connector" fromProperty="ref_fasta" toOperation="RealignCandidates" toProperty="ref_fasta" />
        <link fromOperation="input connector" fromProperty="output_directory" toOperation="RealignCandidates" toProperty="output_directory" />

        <link fromOperation="input connector" fromProperty="input_bam" toOperation="GetCigarIndels" toProperty="input_bam" />
        <link fromOperation="input connector" fromProperty="ref_fasta" toOperation="GetCigarIndels" toProperty="ref_fasta" />
        <link fromOperation="input connector" fromProperty="output_directory" toOperation="GetCigarIndels" toProperty="output_directory" />

        <link fromOperation="RealignCandidates" fromProperty="output_dindel_file" toOperation="MakeDindelWindows" toProperty="input_dindel_file" />
        <link fromOperation="input connector" fromProperty="output_directory" toOperation="MakeDindelWindows" toProperty="output_directory" />

        <link fromOperation="MakeDindelWindows" fromProperty="window_file" toOperation="AnalyzeWindowFile" toProperty="window_file" />
        <link fromOperation="GetCigarIndels" fromProperty="output_libraries" toOperation="AnalyzeWindowFile" toProperty="library_metrics_file" />
        <link fromOperation="input connector" fromProperty="input_bam" toOperation="AnalyzeWindowFile" toProperty="input_bam" />
        <link fromOperation="input connector" fromProperty="ref_fasta" toOperation="AnalyzeWindowFile" toProperty="ref_fasta" />
        <link fromOperation="input connector" fromProperty="output_directory" toOperation="AnalyzeWindowFile" toProperty="output_directory" />

        <link fromOperation="AnalyzeWindowFile" fromProperty="output_bam" toOperation="output connector" toProperty="output_bam" />
        <link fromOperation="AnalyzeWindowFile" fromProperty="output_glf" toOperation="output connector" toProperty="output_glf" />

        <operation name="VcfToDindel">
            <operationtype commandClass="Genome::Model::Tools::Dindel::VcfToDindel" typeClass="Workflow::OperationType::Command" />
        </operation>
        <operation name="RealignCandidates">
            <operationtype commandClass="Genome::Model::Tools::Dindel::RealignCandidates" typeClass="Workflow::OperationType::Command" />
        </operation>
        <operation name="GetCigarIndels">
            <operationtype commandClass="Genome::Model::Tools::Dindel::GetCigarIndels" typeClass="Workflow::OperationType::Command" />
        </operation>
        <operation name="MakeDindelWindows">
            <operationtype commandClass="Genome::Model::Tools::Dindel::MakeDindelWindows" typeClass="Workflow::OperationType::Command" />
        </operation>
        <operation name="AnalyzeWindowFile">
            <operationtype commandClass="Genome::Model::Tools::Dindel::AnalyzeWindowFile" typeClass="Workflow::OperationType::Command" />
        </operation>

        <operationtype typeClass="Workflow::OperationType::Model">
            <inputproperty>input_bam</inputproperty>
            <inputproperty>ref_fasta</inputproperty>
            <inputproperty>input_vcf</inputproperty>
            <inputproperty>output_directory</inputproperty>

            <outputproperty>output_bam</outputproperty>
            <outputproperty>output_glf</outputproperty>
        </operationtype>
    </operation>

    <operationtype typeClass="Workflow::OperationType::Model">
        <inputproperty>input_bam</inputproperty>
        <inputproperty>ref_fasta</inputproperty>
        <inputproperty>input_vcf</inputproperty>
        <inputproperty>base_directory</inputproperty>

        <outputproperty>output_vcf</outputproperty>
    </operationtype>

</workflow>
