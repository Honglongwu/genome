use warnings;
use strict;

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
};

use above 'Genome';
use Test::More;

my $reference_sequence = Genome::Model::Build::ImportedReferenceSequence->get_by_name("GRCh37-lite-build37");

my $tophat_fusion_index_result = Genome::Model::RnaSeq::DetectFusionsResult::TophatFusionResult::Index->create(
    reference_build => $reference_sequence,
    ftp_server => $ENV{GENOME_TEST_URL}."/Genome-Model-RnaSeq-DetectFusionsResult-TophatFusionResult-Index/ucsc/[REF]",
    blast_ftp_url => $ENV{GENOME_TEST_URL}."/Genome-Model-RnaSeq-DetectFusionsResult-TophatFusionResult-Index/blast",
);

isa_ok($tophat_fusion_index_result, "Genome::Model::RnaSeq::DetectFusionsResult::TophatFusionResult::Index", "result exists");

ok(-d $tophat_fusion_index_result->output_dir . "/blast_human", "blast_human directory created under result");
ok(!(-e $tophat_fusion_index_result->output_dir . "/blast_human/blah" ), "only copied the files we were supposed to");

ok(-e $tophat_fusion_index_result->output_dir ."/refGene_sorted.txt", "produced the sorted ref gene file");

my $count = 0;
for(glob $tophat_fusion_index_result->output_dir . "/*.txt"){
    $count++;
}

$DB::single=1;
is($count, 3, "copied the correct number of ucsc files over");

done_testing();

