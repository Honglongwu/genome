#!/usr/bin/env genome-perl

use strict;
use warnings;

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
    $ENV{UR_COMMAND_DUMP_STATUS_MESSAGES} = 1;
};

use above 'Genome';

require File::Compare;
use Test::More;

use_ok('Genome::Model::GenotypeMicroarray::Build::CreateGoldSnpBedFile') or die;
use_ok('Genome::Model::GenotypeMicroarray::Test') or die;

my $build = Genome::Model::GenotypeMicroarray::Test->build();
my $example_build = Genome::Model::GenotypeMicroarray::Test->example_build();
symlink($example_build->formatted_genotype_file_path, $build->formatted_genotype_file_path);
ok(-s $build->formatted_genotype_file_path, 'linked formatted genotype file') or die;

my $cmd = Genome::Model::GenotypeMicroarray::Build::CreateGoldSnpBedFile->create(
    build => $build,
);
ok($cmd, 'create snvs bed file command');
ok($cmd->execute, 'execute snvs bed file command');

is(File::Compare::compare($build->snvs_bed, $example_build->snvs_bed), 0, 'snvs bed file matches');

#print "gvimdiff ".$build->snvs_bed.' '.$example_build->snvs_bed."\n"; <STDIN>;
done_testing();
