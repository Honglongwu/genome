#!/usr/bin/env genome-perl

use strict;
use warnings;

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
    $ENV{UR_COMMAND_DUMP_STATUS_MESSAGES} = 1;
};

use above 'Genome';

use Test::More;

use_ok('Genome::Model::GenotypeMicroarray::GenotypeFile::ReaderFactory') or die;
use_ok('Genome::Model::GenotypeMicroarray::Test') or die;

# Setup
no warnings;
*Genome::File::TypedStream::new = sub{ return bless({}, $_[0]); };
*Genome::Model::GenotypeMicroarray::GenotypeFile::ReadUnannotatedCsv::create = sub{ return bless({}, $_[0]); };
use warnings;

# Reader for inst data [use inst data tsv - needs annotation]
my $instrument_data = Genome::Model::GenotypeMicroarray::Test->instrument_data;
my $variation_list_build = Genome::Model::GenotypeMicroarray::Test->variation_list_build;
my $reader = Genome::Model::GenotypeMicroarray::GenotypeFile::ReaderFactory->build_reader(
    source => $instrument_data,
    variation_list_build => $variation_list_build,
);
ok($reader, 'create reader');
isa_ok($reader, 'Genome::Model::GenotypeMicroarray::GenotypeFile::ReadUnannotatedCsv');

# Reader for legacy build [use inst data tsv - needs annotation]
$reader = Genome::Model::GenotypeMicroarray::GenotypeFile::ReaderFactory->build_reader(
    source => Genome::Model::GenotypeMicroarray::Test->example_legacy_build,
);
ok($reader, 'create reader');
isa_ok($reader, 'Genome::Model::GenotypeMicroarray::GenotypeFile::ReadUnannotatedCsv');

# Reader for build [vcf]
$reader = Genome::Model::GenotypeMicroarray::GenotypeFile::ReaderFactory->build_reader(
    source => Genome::Model::GenotypeMicroarray::Test->example_build,
);
ok($reader, 'create reader');
isa_ok($reader, 'Genome::File::Vcf::Reader');

done_testing();
