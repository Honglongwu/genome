#!/usr/bin/env genome-perl

use strict;
use warnings;

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
    $ENV{UR_COMMAND_DUMP_STATUS_MESSAGES} = 1;
};

use above 'Genome';

use Test::More;

use_ok('Genome::Model::GenotypeMicroarray::GenotypeFile::ReaderForBuildOriginalTsv') or die;
use_ok('Genome::Model::GenotypeMicroarray::Test') or die;

my $build = Genome::Model::GenotypeMicroarray::Test->example_build();

my $reader = Genome::Model::GenotypeMicroarray::GenotypeFile::ReaderForBuildOriginalTsv->create(
    build => $build,
);
ok($reader, 'create reader');

my %cnts;
while ( my $genotype = $reader->read ) {
    $cnts{total}++;
    $cnts{id_ok}++ if $genotype->{id};
    $cnts{no_snp_name}++ if not $genotype->{snp_name};
}
is_deeply(\%cnts, { map { $_ => 9 } (qw/ total id_ok no_snp_name /) }, 'genotypes ok');

done_testing();
