#!/usr/bin/env genome-perl

use strict;
use warnings;

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
    $ENV{NO_LSF} = 1;
};

use above 'Genome';
use Test::More tests => 4;

use Genome::Test::Factory::Model::ReferenceAlignment;
use Genome::Test::Factory::Build;

use_ok('Genome::Model::ReferenceAlignment::Command::Downsample');

my $test_dir      = $ENV{GENOME_TEST_INPUTS} . '/Genome-Model-ReferenceAlignment-Command-Downsample';

my $model = Genome::Test::Factory::Model::ReferenceAlignment->setup_object(
    target_region_set_name => ['testing_the_downsample_command'],
);
my $build = Genome::Test::Factory::Build->setup_object(
    model_id => $model->id,
    status => 'Succeeded',
    data_directory => $test_dir,
);

my $cmd = Genome::Model::ReferenceAlignment::Command::Downsample->create(
    model => $model,
    coverage_in_ratio => '0.5',
);
isa_ok($cmd, 'Genome::Model::ReferenceAlignment::Command::Downsample', 'created command');
ok($cmd->execute, 'executed command');

my $new_model = $cmd->_new_model;
isa_ok($new_model, 'Genome::Model::ReferenceAlignment', 'the command produced a new model as expected');
